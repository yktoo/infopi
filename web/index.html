<!DOCTYPE html>
<html lang="en" ng-app="app">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/vendor/weather-icons/css/weather-icons.min.css" rel="stylesheet">
    <link href="/main.css" rel="stylesheet">
    <title>infopi</title>
</head>
<body ng-controller="HomeController as vm">
    <!-- Date and time -->
    <table class="table datetime" ng-if="vm.now" ng-click="vm.updateNow()">
        <tr>
            <td class="dt-date" ng-bind="vm.now | date:'d.MM'"></td>
            <td class="dt-dow"  ng-bind="vm.now | date:'EEEE'"></td>
            <td class="dt-time" ng-bind="vm.now | date:'HH:mm'"></td>
        </tr>
    </table>

    <!-- Weather: current -->
    <div class="alert alert-info" ng-if="!vm.weather">Failed to fetch weather</div>
    <table class="table weather" ng-if="vm.weather.current" ng-click="vm.updateWeather()">
        <tr>
            <td class="w-icon">
                <i class="wi" ng-class="vm.weather.current.iconWiClass"></i>
                <div class="w-icon-text" ng-bind="vm.weather.current.iconText"></div>
            </td>
            <td class="w-text">{{vm.weather.current.text}}</td>
            <td class="w-temp">
                {{vm.weather.current.temperature}} <i class="wi wi-celsius"></i>
                <p class="w-updated">{{vm.weather.current.station.updated | date:'HH:mm'}}</p>
            </td>
    </table>

    <!-- BuienRadar map and current weather details -->
    <table class="table weather" ng-if="vm.weather.current" ng-click="vm.updateWeather()">
        <tr>
            <!-- Wind direction and speed -->
            <td class="w-smallicon"><i class="wi w-wind" ng-class="'wi-wind-beaufort-' + vm.weather.current.wind.speed"></i></td>
            <td class="w-smalltext">{{vm.weather.current.wind.dirText}}</td>
            <!-- Rain radar -->
            <td class="w-radar-map" rowspan="4">
                <iframe class="radar-map" ng-src="{{vm.radarMapUrl}}" scrolling="no" width="550" height="512" frameborder="no"></iframe>
                <img class="radar-cross" src="/crosshair.png">
            </td>
            <!-- Rain -->
            <td class="w-smallicon"><i class="wi wi-raindrops"></i></td>
            <td class="w-smalltext">{{vm.weather.current.rain === '-' ? 0 : vm.weather.current.rain}} mm/h</td>
        </tr>
        <tr>
            <!-- Wind gusts -->
            <td class="w-smallicon"><i class="wi wi-strong-wind"></i></td>
            <td class="w-smalltext">{{vm.weather.current.wind.gusts}} m/s</td>
            <!-- Sunrise -->
            <td class="w-smallicon"><i class="wi wi-sunrise"></i></td>
            <td class="w-smalltext">{{vm.weather.sunMoon.sunrise | date:'HH:mm'}}</td>
        </tr>
        <tr>
            <!-- Humidity -->
            <td class="w-smallicon"><i class="wi wi-humidity"></i></td>
            <td class="w-smalltext">{{vm.weather.current.humidity}}%</td>
            <!-- Sunset -->
            <td class="w-smallicon"><i class="wi wi-sunset"></i></td>
            <td class="w-smalltext">{{vm.weather.sunMoon.sunset | date:'HH:mm'}}</td>
        </tr>
        <tr>
            <!-- Pressure -->
            <td class="w-smallicon"><i class="wi wi-barometer"></i></td>
            <td class="w-smalltext">{{vm.weather.current.pressure | number:0}} hPa</td>
            <!-- Moon phase -->
            <td class="w-smallicon"><i class="wi w-moon" ng-class="vm.weather.sunMoon.moonPhaseWiClass"></i></td>
            <td class="w-smalltext">{{vm.weather.sunMoon.moonPhaseText}}</td>
        </tr>
    </table>

    <!-- Weather: forecast -->
    <table class="table weather" ng-if="vm.weather.forecast" ng-click="vm.updateWeather()">
        <tr><th class="w-fcast" ng-repeat="day in vm.weather.forecast">{{day.dow}}</th></tr>
        <tr>
            <td class="w-fcast" ng-repeat="day in vm.weather.forecast">
                <i class="wi" ng-class="day.iconWiClass"></i>
                <span class="w-fcast-temp">{{day.temperature.lowMin}} ··· {{day.temperature.highMax}}</span>
            </td>
        </tr>
        <tr>
            <td class="w-fcast w-fcast-probs" ng-repeat="day in vm.weather.forecast">
                <i class="wi wi-raindrop"></i> <span class="w-fcast-prob">{{day.rain.probability}}</span>
                <i class="wi wi-day-sunny"></i> <span class="w-fcast-prob">{{day.probSun}}</span>
            </td>
        </tr>
    </table>

    <!-- Trains -->
    <table class="table trains">
        <tr>

        <!-- Train departure times -->
        <td class="width50" ng-click="vm.updateDepartureTimes()">
            <h2>Houten Castellum</h2>
            <table class="table">
                <tr ng-repeat="train in vm.trainDepartureTimes1 | limitTo:12">
                    <td class="train-time" >{{train.time | date:'HH:mm'}}</td>
                    <td class="train-delay">{{train.delay}}</td>
                    <td class="train-dest" >
                        {{train.dest}}
                        <div class="train-notes" ng-bind="train.notes"></div>
                    </td>
                    <td class="train-type" >{{train.type}}</td>
                    <td class="train-platf">{{train.platf}}</td>
                </tr>
            </table>
        </td>

        <!-- Travel advice -->
        <td class="width50" ng-click="vm.updateDepartureTimes()">
            <h2>Utrecht Centraal</h2>
            <table class="table">
                <tr ng-repeat="train in vm.trainDepartureTimes2 | limitTo:12">
                    <td class="train-time" >{{train.time | date:'HH:mm'}}</td>
                    <td class="train-delay">{{train.delay}}</td>
                    <td class="train-dest" >
                        {{train.dest}}
                        <div class="train-notes" ng-bind="train.notes"></div>
                    </td>
                    <td class="train-type" >{{train.type}}</td>
                    <td class="train-platf">{{train.platf}}</td>
                </tr>
            </table>
        </td>
        </tr>
    </table>

    <table class="table busses">
        <tr>
            <!-- Bus departure times -->
            <td class="width50" ng-click="vm.updateBusData()">
                <h2>De Erven/De Schaft</h2>
                <table class="table">
                    <tr ng-repeat="bus in vm.busData">
                        <td class="bus-time">{{bus.TargetDepartureTime | date:'HH:mm'}}</td>
                        <td class="bus-delay">{{bus.delay ? '+' : ''}}{{bus.delay | date:'m:ss'}}</td>
                        <td class="bus-line">{{bus.LinePublicNumber}}</td>
                        <td class="bus-dest">{{bus.DestinationName50}}</td>
                    </tr>
                </table>
            </td>

            <!-- Security -->
            <td class="width50" ng-click="vm.updateSecurity()">
                <h2 ng-class="{'security-armed': vm.securityAccessControl.state === 'ON'}">Security</h2>
                <table class="table security">
                    <tr ng-repeat="device in vm.securityDevices | filter:{name:'Door'} | orderBy:'name'" ng-class="{warning: device.state === 'OPEN'}">
                        <td class="security-dev-name">{{device.label || device.name}}</td>
                        <td class="security-dev-state" ng-class="{'security-status-unknown': device.state === 'NULL'}">
                            {{device.state === 'NULL' ? '?' : device.state}}
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <!-- FX rates (docked at the bottom) -->
    <table class="table fx" ng-if="vm.fx" ng-click="vm.updateFx()">
        <tr>
            <td ng-repeat="rate in vm.fx">
                <div class="fx-ccy">{{rate.label}}</div>
                {{rate.rate | number:2}}
                <div class="fx-move" ng-class="{up: rate.movedUp, down: rate.movedDown}">{{rate.move | number:2}}</div>
            </td>
            <td ng-repeat="rate in vm.cryptoRates">
                <div class="fx-ccy">{{rate.label}}</div>
                {{rate.rate | number:2}}
            </td>
        </tr>
    </table>

    <!-- Scripts -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
    <script src="app.module.js"></script>
    <script src="app-services/nsapi.service.js"></script>
    <script src="app-services/ovapi.service.js"></script>
    <script src="app-services/buienRadar.service.js"></script>
    <script src="app-services/fx.service.js"></script>
    <script src="app-services/crypto.service.js"></script>
    <script src="app-services/openhab.service.js"></script>
    <script src="home/controller.js"></script>
</body>
</html>
